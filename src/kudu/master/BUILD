load("//:setup.bzl", "kudu_cc_binary", "kudu_cc_library", "kudu_proto_library")

package(default_visibility = ["//visibility:public"])

kudu_proto_library(
    name = "master_proto",
    srcs = ["master.proto"],
    has_services = True,
    protodeps = [
        "//kudu/common:common_proto",
        "//kudu/common:wire_protocol_proto",
        "//kudu/consensus:metadata_proto",
        "//kudu/consensus:replica_management_proto",
        "//kudu/rpc:rpc_header_proto",
        "//kudu/security:token_proto",
        "//kudu/tablet:metadata_proto",
        "//kudu/util:pb_util_proto",
    ],
)

kudu_cc_binary(
    name = "kudu-master",
    srcs = [
        "authz_provider.cc",
        "authz_provider.h",
        "auto_rebalancer.cc",
        "auto_rebalancer.h",
        "catalog_manager.cc",
        "catalog_manager.h",
        "default_authz_provider.h",
        "hms_notification_log_listener.cc",
        "hms_notification_log_listener.h",
        "location_cache.cc",
        "location_cache.h",
        "master.cc",
        "master.h",
        "master-test-util.h",
        "master_cert_authority.cc",
        "master_cert_authority.h",
        "master_main.cc",
        "master_options.cc",
        "master_options.h",
        "master_path_handlers.cc",
        "master_path_handlers.h",
        "master_runner.cc",
        "master_runner.h",
        "master_service.cc",
        "master_service.h",
        "mini_master.cc",
        "mini_master.h",
        "placement_policy.cc",
        "placement_policy.h",
        "ranger_authz_provider.cc",
        "ranger_authz_provider.h",
        "sys_catalog.cc",
        "sys_catalog.h",
        "table_locations_cache.cc",
        "table_locations_cache.h",
        "table_locations_cache_metrics.cc",
        "table_locations_cache_metrics.h",
        "table_metrics.cc",
        "table_metrics.h",
        "ts_descriptor.cc",
        "ts_descriptor.h",
        "ts_manager.cc",
        "ts_manager.h",
    ],
    deps = [
        "master_proto_cc",
        "//kudu/consensus:consensus_proto_cc",
        "//kudu/hms",
        "//kudu/hms:hms_thrift_cc",
        "//kudu/kserver",
        "//kudu/ranger:client",
        "//kudu/rebalance",
        "//kudu/server",
        "//kudu/tserver",
        "//kudu/tserver:tserver_admin_proto_cc",
    ],
)
